# 네트워크

컴퓨터 등의 장치들이 통신 기술을 이용해 구축하는 연결망.

노드와 링크가 서로 연결되어 있거나 연결된 상태로 리소스를 공유하는 집합.

* 노드 : 서버, 라우터, 스위치 등 네트워크 장치를 의미

## 규모에 따른 분류
* LAN : 근거리 통신망 / 빠른 전송속도 / 혼잡x
* MAN : 대도시 지역 네트워크 / 평균 전송속도 / LAN보다 혼잡
* WAN : 국가나 대륙을 대상으로 하는 광역 네트워크 / 느린 전송속도 / MAN보다 혼잡

## 네트워크 처리량(bps)

링크 내에서 성공적으로 전달된 데이터의 양.

보통 트래픽을 얼마나 처리했는지를 나타냄.

트래픽, 네트워크 장치 간 대역폭, 에러, 장치의 하드웨어 스펙 등에 영향을 받는다.

* 트래픽 : 특정 시점에 링크 내에 흐르는 데이터의 양
* 대역폭 : 주어진 시간 동안 네트워크 연결을 통해 흐를 수 있는 최대 비트 수

## 네트워크 지연 시간

어떤 메시지가 두 장치 사이를 왕복하는 데 걸리는 시간(요청이 처리되는 시간)

매체 타입, 패킷 크기, 라우터의 패킷 처리 시간에 영향을 받음.

# 네트워크 토폴로지(네트워크 구조)
노드와 링크가 배치되는 방식(연결 형태)

병목 현상을 찾을 때 중용한 기준이 되므로 중요함.

## 트리 토폴로지(계층형 토폴로지)
노드 추가&삭제가 용이함

특정 노트에 트래픽 집중 시 하위 노드에 영향.

## 버스 토폴로지
중앙 회선 하나에 여러 개의 노드를 연결. LAN에서 사용.

노드 추가&삭제가 용이함, 적은 설치비용, 우수한 신뢰성

스푸핑 문제
* 스푸핑 : 스위칭 기능 마비. 송신과 관련 없는 특정 노드에 해당 패킷이 오게 한다.

## 스타 토폴로지
노드 추가&에러 탐지가 용이함, 패킷 충돌 가능성 적음

중앙노드에 장애 발생 시 전체 네트워크 사용 불가능.

## 링형 토폴로지
노드 수 증가해도 네트워크 상의 손실 거의 없음, 충돌 발생 가능성 적음, 노드 고장 발견이 용이함.

네트워크 구성 변경이 어렵고 회선에 장애 발생 시 전체에 영향을 줌.

## 메시 토폴로지(망형 토폴로지)
한 단말 장치에 장애가 발생해도 네트워크 계속 사용 가능

노드 추가가 어려움, 구축 비용 & 운용 비용이 고가임.

# 병목현상
전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한 받은 현상으로, 지연 시간이 길어짐.

트래픽 관리 등이 필요함.

네트워크 대역폭, 네트워크 토폴로지, 서버 CPU, 메모리 사용량, 비효율적인 네트워크 구성이 주된 원인임.

# 네트워크 성능 분석 명령어
코드 상 문제가 없는데 데이터 못 가져올 경우 병목현상 때문일 수 있음.

1) ping

        네트워크 상태를 확인하려는 대상 노드로 일정 크기의 패킷 전송.

        노드의 패킷 수싱 상태, 도달하기까지의 시간, 네트워크 연결이 잘 되어있는지를 확인 가능.

        ICMP 프로토콜을 통해 동작 --> ICMP 프로토콜 지원x 기기, 네트워크 정책 상 ICMP나 traceroute 차단 대상인 경우 실행 불가능.
2) netstat

        접속되어 있는 서비스들의 네트워크 상태 표시.

        네트워크 접속, 라우팅 테이블, 네트워크 프로토콜 등 리스트 보여줌.

        주로 서비스의 포트가 열려있는지 확인용.
3) nslookup

        DNS에 관련된 내용 확인. 특정 도메인에 매핑된 IP 확인용.
   
5) tracert

        목적지 노드까지 네트워크 경로 확인.

        목적지 노드까지의 구간들 중 어디에서 응답시간이 느려지는지 확인 가능.

# 네트워크 프로토콜
다른 장치들끼리 데이터를 주고받기 위해 설정된 공통된 인터페이스

IEEE 또는 IETF 라는 표준화 단체가 정함.

# TCP/IP 4계층 모델
네트워크에서 사용되는 통신 프로토콜의 집합을 4개 계층으로 설명하는 계층모델

|TCP/IP|OSI 7계층|
|------|------|
|애플리케이션|애플리케이션, 프레젠테이션, 세션|
|전송|전송|
|인터넷|네트워크|
|링크|데이터 링크, 물리|


## 애플리케이션 계층
응용 프로그램이 사용되는 프로토콜 계층. 웹서비스, 이메일 등을 실질적으로 제공.

```
FTP : 장치와 장치 간 파일 전송에 사용되는 표준 통신 프로토콜

SSH : 보안이 안 되는 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜

HTTP : World Wide Web을 위한 데이터 통신의 기초이자 웹사이트 이용에 사용.

SMTP : 전자메일 전송을 위한 인터넷 표준 통신 프로토콜

DNS : 도메인 이름과 ip 주소를 매핑해주는 서버
```
## 전송 계층
송신자와 수신자 연결 통신 서비스 제공, 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공 가능.

애플리케이션과 인터넷 계층 간 데이터가 전달될 때 중계 역할.

### TCP vs UDP
|TCP|UDP|
|------|------|
|패킷 사이 순서 보장O|순서 보장x|
|연결 지향 프로토콜->신뢰성 구축->수신 여부 확인O|수신 여부 확인x|
|신뢰성O|신뢰성x|
|가상회선 패킷 교환 방식|데이터그램 패킷 교환 방식|

* 가상회선 패킷 교환 방식 : 각 패킷에 가상 회선 식별자를 포함시킨 상태로 모든 패킷을 전송, 가상회선을 해제함. 전송된 순서대로 패킷이 도착한다.
* 데이터그램 패킷 교환 방식  각 패킷이 독립적으로 최적의 경로를 선택하여 간다. 서로 다른 경로로 전송될 수 있고 순서가 다를 수 있다.

### TCP -> 3-way handshake(연결 성립 과정)
3-way handshake 이후 신뢰성이 구축되고 데이터 전송이 시작됨.


1) SYN 단계 : 클라이언트의 ISN을 서버에 보냄
2) SYN + ACK 단계 : 서버가 서버의 ISN을 보내는데 승인번호를 클라이언트의 ISN+1로 설정함.
3) ACK 단계 : 클라이언트가 서버의 ISN+1한 값을 승인번호로 해서 ACK을 서버에 보냄.

* 각 단계별 클라이언트와 서버의 상태
```
클라이언트 : CLOSED -> SYN-SENT -> ESTABLISHED
서버 : CLOSED -> LISTEN -> SYN-RECEIVED -> ESTABLISHED
(LISTEN상태의 서버에 클라이언트가 SYN을 보낸다.)
```
### TCP -> 4-way handshake(연결 해제 과정)


1) 클라이언트가 FIN으로 설정된 세그먼트 전송, 서버의 응답을 기다림.
2) 서버는 클라이언트한테 승인 세그먼트(ACK) 전송, 서버는 CLOSE_WAIT이 되고 클라이언트는 ACK 받으면 FIN_WAIT_2가 됨.
3) 서버가 ACK을 보낸 후 일정 시간 후 클라이언트에게 FIN 세그먼트 전송
4) 클라이언트가 TIME_WAIT 상태가 된 후 다시 서버로 ACK 전송, 서버가 CLOSED 됨. 클라이언트는 잠시 대기하다가 연결 닫고 모든 자원의 연결이 해제됨.

* 각 단계별 클라이언트와 서버의 상태
```
클라이언트 : ESTABLISHED -> FIN_WAIT_1 -> FIN_WAIT_2 -> TIME_WAIT -> CLOSED
서버 : ESTABLISHED -> CLOSE_WAIT -> LAST_ACK -> CLOSED
(LISTEN상태의 서버에 클라이언트가 SYN을 보낸다.)
```

* TIME_WAIT : 소켓 바로 소멸X, 일정 시간 동안 유지. 지연 패킷 발생하는 경우(데이터 무결성 문제)의 문제 해결+두 장치 연결 닫혔는지 확인. OS마다 얼마나 유지되는지는 조금씩 다름.

## 인터넷 계층
장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용됨.

IP, ARP, ICMP 등이 있음.

패킷을 수신해야 할 상대의 주소를 지정, 데이터를 전달.

비연결형

## 링크 계층(네트워크 접근 계층)
실질적으로 데이터를 전달.

장치 간에 주고받는 규칙을 정함.

* 데이터 링크 계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어 담당.
* 물리 계층 : 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터 보냄.
* 이더넷 프레임 : 데이터 링크 계층에서의 캡슐화된 데이터.

### 전이중화 통신
유선LAN을 이루는 이더넷이 전이중화 통신을 사용함.

양쪽 장치가 동시에 송수신할 수 있는 방식.

송신로와 수신로를 나눠 데이터를 주고받음.

유선 LAN을 이루는 케이블은 트위스트 페어 케이블(TP 케이블), 광섬유 케이블이 대표적임.

### 반이중화 통신
무선 LAN은 수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신을 사용함.

동시 통신 불가능. 한 번에 한 방향만 통신 가능. 충돌 방지 시스템 필요.

무선 LAN은 대표적으로 wifi, BSS, ESS가 있음.

* wifi : 무선 접속 장치 필요
* BSS : 기본 서비스 집합. 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조. 근거리 무선 통신. 하나의 AP만을 기반으로 구축. 사용자의 자유로운 이동X.
* ESS : 하나 이상의 연결된 BSS 그룹. 장거리 무선 통신. BSS보다 더 많은 가용성과 이동성. 사용자는 다른 장소로 이동하며 중단 없이 네트워크에 계속 연결 가능.

#### CSMA/CD
옛날엔 유선LAN에 CSMA/CD 방식을 사용함.

이 방식은 충돌 발생 시 일정 시간 이후 재전송.(수신로와 송신로 각각X, 한 경로 기반임 -> 충돌 대비 필요)

#### CSMA/CA
캐리어 감지 등으로 사전에 충돌 방지를 하고자 함.
1) 데이터 통신 전 무선 매체 확인
2) 캐리어 감지(회선이 비어 있는지)
3) IFS(잠시 기다렸다가 무선 매체가 사용 중이면 간격을 늘려가며 기다림.)
4) 데이터 송신
